<!DOCTYPE html>
<html>

<head>
	<title>OpenLime</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="UTF-8" />

	<link rel="icon" type="image/png" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHdpZHRoPSI2MnB4IgogICBoZWlnaHQ9IjYycHgiCiAgIHZpZXdCb3g9IjAgMCA2MiA2MiIKICAgdmVyc2lvbj0iMS4xIj4KICA8Y2lyY2xlCiAgICAgdHJhbnNmb3JtPSJyb3RhdGUoNDUpIgogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFjZDVhO2ZpbGwtb3BhY2l0eToxIgogICAgIGN4PSI0My44NDA2MjIiCiAgICAgY3k9IjAiCiAgICAgcj0iMjguODgxNjk3IiAvPgogIDxwYXRoCiAgICAgZD0ibSAzOC4zOTk2OTUsMjcuMDUxODA5IC03LjkzNjQzNiwtNC42MTIwMjIgLTEuMjY1OTc2LC0xLjI2NTk3NiAtOC4wOTgzOTUsLTguMDk4Mzk1IC0yLjk1NzIzNCwtMi45NTcyMzQgYyAtMC43MDEzNTEsLTAuNzAxMzUwNSAtMS44MzA1OTcsLTAuNzAxMzU0IC0yLjUzMTk0OCwtMmUtNiBsIC01LjA1MzM4Niw1LjA1MzM4NiBjIC0wLjcwMTM1MjYsMC43MDEzNTIgLTAuNzAxMzQ5LDEuODMwNTk4IDNlLTYsMi41MzE5NDggbCAyLjk1NzIzMywyLjk1NzIzNSA4LjA5ODM5NSw4LjA5ODM5NSAxLjI2NTk3NSwxLjI2NTk3NSA0LjYxMjAyMiw3LjkzNjQzNyA1LjY3NDYzLDUuNjc0NjMxIDEwLjkwOTc0OCwtMTAuOTA5NzQ3IHoiCiAgICAgc3R5bGU9ImZpbGw6IzVmODJjMzsiLz4KICA8cGF0aCBkPSJtIDM4LjM5OTY5MiwyNy4wNTE4MTIgMi4yODEwNjksMi4yODEwNyAtMTAuOTA5NzQ0LDEwLjkwOTc0NCAtMi4yODEwNjksLTIuMjgxMDcgeiIKICAgICBzdHlsZT0iZmlsbDojNDE1YTg3OyIvPgogIDxjaXJjbGUKICAgICB0cmFuc2Zvcm09InJvdGF0ZSg0NSkiCiAgICAgcj0iMS43MTg0MjI4IgogICAgIGN5PSItMC4zMDk4MDYyOSIKICAgICBjeD0iMzYuOTc3MjI2IgogICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjAuMjQ3NDc0NzYiLz4KICA8cGF0aAogICAgIGQ9Ik0gNTkuMDUzMDkyLDM3LjIwOTcgNDMuMTc3MjMsMzMuNjIzMjI1IDMzLjkwODMwMSw0Mi44OTIxNTMgYyAwLDAgMS45ODAxNjIsOS4yMjExNiAzLjQ0NjE1OSwxNi4xMDA5NTIgQSAyOC44ODE2OTcsMjguODgxNjk3IDAgMCAwIDUxLjMwNDI1OSw1MS4zMDQxOTkgMjguODgxNjk3LDI4Ljg4MTY5NyAwIDAgMCA1OS4wNTMwOTIsMzcuMjA5NyBaIgogICAgIHN0eWxlPSJmaWxsOiNmY2UwOTQ7Ii8+CiAgPHBhdGgKICAgICBkPSJtIDU2Ljc4NTczOCw0My41NzQwMDMgLTE0Ljk1OTA1NCwtOC42MDAyMzIgLTYuNDE0NzMsNi40MTQ3MyA4LjczMzI0MSwxNS4xMzczNzMgYSAyOC44ODE2OTcsMjguODgxNjk3IDAgMCAwIDcuMTU5MDY0LC01LjIyMTY3NSAyOC44ODE2OTcsMjguODgxNjk3IDAgMCAwIDUuNDgxNDc5LC03LjczMDE5NiB6IgogICAgIHN0eWxlPSJmaWxsOiNmZWY5ZDQ7Ii8+Cjwvc3ZnPgo=">
	<link rel="stylesheet" href="skin.css"/>

	<style>
		html, body {
			margin: 0px;
			padding: 0px;
			height: 100%;
		}

		#openlime {
			position:relative;
			height: 100%
		}

		#openlime>canvas {
			width: 100%;
			height: 100%;
			/* this is important, it would cause firefox flickering! */
			overflow: hidden;
		}

        .openlime-overlaymsg {
            background: black;
            color: #fff;
            opacity: 80%;
            animation: fadeOut 3s;
        }

        .openlime-dialog.hidden {
            pointer-events: none;
            opacity: 0;
        }
        .openlime-dialog.visible {
            pointer-events: visible;
            opacity: 1;
        }
	</style>
</head>

<body>
<div id="openlime"></div>
<div id="info">
    <h3>RTI Viewer Instructions</h3>
    <p>This view allows you to interactively explore the surface by moving the light source. Click and drag on the image to change the lighting direction and reveal surface details.</p>
    <p>Clicking the light bulb icon <img height="30px" src="/img/documentView/rti-light-bulb.png"/> in the toolbar below the image to disable light mode. Once disabled, you can pan and move the image as normal.</p>
    <p>Clicking the layers icon <img height="30px" src="/img/documentView/rti-layers.png"/> in the toolbar below the image to view a list of different image layers to visualise.</p>
</div>
</body>

<script src="openlime.min.js"></script>

<script>

    // Helper function to parse URL parameters
    function getUrlParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
    }

    async function init() {
        let layout = "tarzoom";
        const lime = new OpenLIME.Viewer('#openlime', { background: 'black' });

        // Get the ?url= parameter, or default if not provided
        const urlParam = getUrlParam("url");
        const rtiUrl = urlParam || "";

        const layer = new OpenLIME.Layer({
            layout: layout,
            type: 'rti',
            url: rtiUrl,
            normals: false
        });
        lime.canvas.addLayer('RTI', layer);
        OpenLIME.Skin.setUrl('skin.svg');

        const ui = new OpenLIME.UIBasic(lime, {
            showLightDirections: true,
            attribution: "Â©Cambridge University Library",
            skin: 'skin.svg'
        });

        let { help, home, fullscreen, light, zoomin, zoomout, layers, rotate } = ui.actions

        ui.actions.light.active = true;
        ui.actions.zoomin.display = true;
        ui.actions.zoomout.display = true;
        ui.actions.rotate.display = true;
        ui.actions.layers.display = true;
        ui.showLightDirections = true;
        ui.showOverlayMessage('loading ...', 2000);

        //Create a custom information dialog
        let openlime = document.querySelector('#openlime');
        let infoDialog = new OpenLIME.UIDialog(openlime, { modal: false });
        infoDialog.setContent(document.getElementById('info'));
        infoDialog.hide();


        // Add new action (customInfo). Its behaviour is defined in the function "task"
        // The action can be activated by pressing the button (with i) in the toolbar
        let customInfo = {
            title: 'Show Help Information',
            display: true,
            icon: `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   width="19.314583mm"
   height="19.314583mm"
   viewBox="0 0 19.314583 19.314583"
   version="1.1"
   id="svg3279"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs3276" />
  <g
     id="g406"
     transform="translate(-0.68252549,0.36637701)">
    <rect
       ry="3.175"
       rx="3.175"
       y="-0.10179351"
       x="0.94710898"
       height="18.785416"
       width="18.785416"
       id="rect2993-9-3"
       style="fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:#666666;stroke-width:0.529167;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
    <g
       aria-label="i"
       transform="scale(1.1476023,0.87138203)"
       id="text348"
       style="font-size:25.9103px;line-height:1.25;font-family:'Palace Script MT';font-variant-ligatures:none;letter-spacing:0px;word-spacing:0px;stroke-width:0.303636">
      <path
         d="M 12.106211,18.992435 C 11.225261,18.888794 10.888427,18.50014 10.888427,17.515548 V 7.6696346 H 5.9136497 v 0.6218472 c 1.1400532,0.2072824 1.3473356,0.4404751 1.3732459,1.5287077 v 7.6176275 c -0.02591,1.088233 -0.2072824,1.295515 -1.3732459,1.554618 v 0.621848 H 12.106211 Z M 9.0747063,1.7102658 c -1.1141429,0 -2.0210034,0.9068605 -2.0210034,1.995093 0,1.1659635 0.8550399,2.0210034 1.9950931,2.0210034 1.140053,0 2.021003,-0.8550399 2.021003,-1.9950931 0,-1.1400531 -0.88095,-2.0210033 -1.9950927,-2.0210033 z"
         style="font-weight:bold;font-family:'Nimbus Roman';"
         id="path400" />
    </g>
  </g>
</svg>`,
            task: (event) => {
                infoDialog.toggle();
            }
        };

        // Add configured actions to the toolbar
        ui.actions = { customInfo, home, light, zoomin, zoomout, layers, rotate, fullscreen };

        lime.camera.maxFixedZoom = 1;
        window.lime = lime;
    }

    init();

</script>

</html>
